#!/usr/bin/env ruby
# Filetype detection for the current acme window.

require 'mime/types'
require './acme'

def type_from_file_command(path)
  type = `file -bI #{path}`.split(";")[0]

  mime = MIME::Types[type].first
    
  # `file` returns text/x-ruby but MIME::Types wants application/ruby
  if mime.nil? && type =~ %r{text/x-(.+)}
    mime = MIME::Types["application/#{$1}"].first
  end
  
  if mime
    mime.sub_type
  else
    ""
  end
end


win = A::Win.new(ENV["winid"])

case win.file.extname()
when ".rb"
  print "ruby"
when ".py"
  print "python"
when ".c", ".h", ".cpp", ".cc"
  print"c"
when ".go"
  print "go"
when ""
  print type_from_file_command(win.file)
end
